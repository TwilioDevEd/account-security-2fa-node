<!DOCTYPE html><html><head><title>Two-Factor Authentication with Authy</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Two-Factor Authentication with Authy"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Two-Factor Authentication with Authy</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to implement two-factor authentication (2FA) in your web app with Twilio-powered Authy. 2FA helps further secure your users' data by validating more than just a password. This tutorial will show you the code to make it happen.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Application Setup" class="chapter"><div data-file="models/User.js" data-highlight="" class="step"><h2 id="what-does-this-thing-do-">What does this thing do?</h2>
<p>This <a href="http://expressjs.com/">Express.js</a> sample application
demonstrates how to build a login system that uses two factors of authentication to login users.
Head to the <a href="https://github.com/TwilioDevEd/2fa-node">application&#39;s
README.md</a>
to see how to run the application locally.</p>
<p>Adding two-factor authentication (2FA) to your web application increases the 
security of your user&#39;s data. <a href="http://en.wikipedia.org/wiki/Multi-factor_authentication">Multi-factor authentication</a> 
determines the identity of a user by validating once by logging into the app, 
and second by validating their mobile device.</p>
<p>For the second factor, we will validate that the user has their mobile phone by either:</p>
<ul>
<li>Sending them a OneTouch push notification to their mobile Authy app or</li>
<li>Sending them a token through their mobile Authy app or</li>
<li>Sending them a one-time token in a text message <a href="http://www.authy.com/">sent with Authy via Twilio</a>. Here&#39;s how this works at a high level:</li>
</ul>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-high-level.png" alt="2FA High Level"></p>
<p>Let&#39;s get started! Click the right arrow above to move to the next step
  of the tutorial.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="http://expressjs.com/starter/hello-world.html">Getting started with Express.js</a></li>
<li><a href="https://github.com/evilpacket/node-authy">node-authy library</a></li>
</ul>
</div><div data-file="config.js" class="step"><h2 id="configuring-authy">Configuring Authy</h2>
<p>If you haven&#39;t already, now is the time to <a href="https://dashboard.authy.com/signup">sign up for Authy</a>. 
Create your first application, naming it whatever you wish. After you create your application, 
your &quot;production&quot; API key will be visible on your <a href="https://dashboard.authy.com">dashboard</a>:</p>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-authy-dashboard.png" alt="Authy Dashboard"></p>
<p>Once we have an Authy API key, we store it in this initializer file. </p>
<p>Now that we&#39;ve configured our Express app, let&#39;s take a look at how we 
register a user with Authy.</p>
</div></div><div data-title="Logging in with Authy OneTouch" class="chapter"><div data-file="models/User.js" data-highlight="62-76" class="step"><h2 id="registering-a-user-with-authy">Registering a User with Authy</h2>
<p>When a new User is created we also register the User with Authy.</p>
<p>All Authy needs to get a user set up for your application is the email,
phone number and country code. In order to do two-factor authentication,
we need to make sure we ask for these things at the point of sign up.</p>
<p>Once we register the User with Authy we get an <code>id</code> back that we will
store as the user&#39;s <code>authyId</code>. This is very important since it&#39;s how we
will verify the identity of our User with Authy.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//docs.authy.com/#section-Enabling_two-
factor_on_a_user">Enabling a User with Authy</a></li>
<li><a href="//mongoosejs.com/docs/guide.html">Getting started with Mongoose</a></li>
<li><a href="//mongoosejs.com/docs/middleware.html">Mongoose Middleware</a></li>
</ul>
</div><div data-file="api/sessions.js" data-highlight="7-44" class="step"><h2 id="logging-in-with-authy-onetouch">Logging in with Authy OneTouch</h2>
<p>When a User attempts to log in to our website, we will ask them for a second 
form of identification. Let&#39;s take a look at Authy&#39;s OneTouch verification first. </p>
<p><img src="//howtodocs.s3.amazonaws.com/onetouch-approved.gif" alt="Authy OneTouch Approval"></p>
<p>OneTouch works like so:</p>
<ul>
<li>We attempt to send a User a <em>OneTouch Approval Request</em></li>
<li>If the User has OneTouch enabled, we will get a <code>success</code> message back</li>
<li>The User hits &#39;Approve&#39; in their Authy app</li>
<li>Authy makes a POST request to our app with an &#39;Approved&#39; status</li>
<li>We log the User in</li>
</ul>
<p>In the next steps we&#39;ll look at how we handle cases where the User does not 
have OneTouch, or denies the login request.</p>
</div><div data-file="models/User.js" data-highlight="88-108" class="step"><h2 id="sending-the-onetouch-request">Sending the OneTouch Request</h2>
<p>When our User logs in we immediately attempt to verify their identity with 
OneTouch. We will fallback gracefully if they don&#39;t have a OneTouch device, 
but we don&#39;t know until we try.</p>
<p>Authy lets us pass details with our OneTouch request, including a message, 
a logo and any other details we want to send. We could easily send any 
number of details by appending <code>details[&#39;some_detail&#39;]</code>. You could imagine a 
scenario where we send a OneTouch request to approve a money transfer:</p>
<pre><code class="cm-s-monokai lang-js"><span class="cm-variable">details</span> <span class="cm-operator">=</span> {
  <span class="cm-property">message</span>: <span class="cm-string">&quot;Request to send money to Jarod&#39;s vault&quot;</span>,
  <span class="cm-property">from</span>: <span class="cm-string">&quot;Jarod&quot;</span>,
  <span class="cm-property">amount</span>: <span class="cm-string">&quot;1,000,000&quot;</span>,
  <span class="cm-property">currency</span>: <span class="cm-string">&quot;Galleons&quot;</span>
},
</code></pre>
<p><em>Note: We need some way to check the status of the user&#39;s two-factor process, in this case we do so by updating the <code>User.authyStatus</code> attribute. It&#39;s important we reset this before we log the user in.</em></p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//docs.authy.com/new_doc/authy_onetouch_api#create-an-approval-request-to-be-sent-to-user">Create Approval Requests with Authy</a></li>
<li><a href="//docs.authy.com/new_doc/authy_onetouch_api#getting-approval-request-info">Getting Approval Request info</a></li>
</ul>
</div><div data-file="api/sessions.js" data-highlight="57-70" class="step"><h2 id="configuring-the-onetouch-callback">Configuring the OneTouch callback</h2>
<p>In order for our app to know what the User did after we sent the OneTouch 
request, we need to register a callback endpoint with Authy.</p>
<p><img src="//howtodocs.s3.amazonaws.com/onetouch-callback-endpoint.png" alt="Authy OneTouch Callback"></p>
<p>Here in our callback, we look up the user using the <code>authy_id</code> sent with the Authy POST request. Ideally at this point we would probably use a websocket to let our client know that we received a response from Authy. However for this version we&#39;re going to keep it simple and just update the <code>authyStatus</code> on the User. Then all our client-side code needs to do is check for <code>user.authyStatus.approved</code> before logging her in.</p>
<p>Let&#39;s take a look at the client-side code that will be handling this.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//mongoosejs.com/docs/queries.html">Mongoose findOne Query</a></li>
<li><a href="//github.com/expressjs/body-parser#bodyparserjsonoptions">Using BodyParser for JSON</a></li>
</ul>
</div><div data-file="public/app/views/Login.js" class="step"><h2 id="handling-two-factor-asyncronously">Handling Two-Factor Asyncronously</h2>
<p><em>Our user interface for this example is a <a href="http://en.wikipedia.org/wiki/Single-page_application">single page application</a> written using <a href="http://backbonejs.org/">Backbone</a> and <a href="http://jquery.com/">jQuery</a>.</em></p>
<p>We&#39;ve already taken a look at what&#39;s happening on the server side, so
let&#39;s step in front of the cameras now and see how our JavaScript is
interacting with those server endpoints.</p>
<p>First we hijack the login form submit and pass the data to our
<code>/session</code> controller using Ajax. Depending on how that endpoint
responds we will either ask the User for a token or await their OneTouch
response.</p>
<p>If we expect a OneTouch response, we will begin polling <code>/authy/status</code>
until we either see OneTouch login was either approved or denied. Let&#39;s
take a look at this controller and see what is happening.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//api.jquery.com/jquery.post/">jQuery Post method</a></li>
</ul>
</div><div data-file="api/sessions.js" data-highlight="72-87" class="step"><h2 id="falling-back-to-token">Falling back to Token</h2>
<p>Here is the endpoint that our javascript is polling. It is waiting for the 
user status to be either &#39;Approved&#39; or &#39;Denied&#39;. If the User has approved 
the OneTouch request, we will save their session as <code>confirmed</code>, which 
officially logs them in.</p>
<p>If the request was denied we render the <code>/verify</code> page and ask the User to log in with a Token.</p>
<p>Now let&#39;s take a look at how we handle two-factor with tokens.</p>
</div></div><div data-title="Falling Back to Token" class="chapter"><div data-file="models/User.js" data-highlight="110-125" class="step"><h2 id="sending-a-2fa-token">Sending a 2FA Token</h2>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow5.png" alt="2FA Flow Chart Step 5"></p>
<p>Once there is an Authy user ID associated with our user model, we can request that an SMS verification token be sent out to the user&#39;s phone. Authy supports token validation in their mobile app as well, so if our user has the app it will default to sending a push notification instead of an SMS.</p>
<p>We can call this method on the user instance multiple times if needed, which is what happens every time the user clicks &quot;Resend Code&quot; on the web form we are about to look at!</p>
</div><div data-file="api/sessions.js" data-highlight="89-112" class="step"><h2 id="validating-the-code">Validating the Code</h2>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow8.png" alt="2FA Flow Chart Step 8"></p>
<p>Back in our Express route handler, we grab the code that was submitted from the form to validate. We have <a href="http://stephensugden.com/middleware_guide/">Connect middleware</a> function that executes before this handler and adds a <code>user</code> property to the <code>request</code> object that contains a Mongoose model instance representing the user associated with this session. We use <code>verifyAuthyToken</code> on the <code>User</code> model to check if the code submitted by the user is legit.</p>
</div><div data-file="models/Session.js" class="step"><h2 id="where-to-next-">Where to next?</h2>
<p>That&#39;s it! We&#39;ve just implemented two-factor auth using three different methods and the latest in Authy technology.</p>
<p>If you&#39;re a Node.js developer working with Twilio, you might want to
check out these other tutorials.</p>
<p><a href="//www.twilio.com/docs/howto/walkthrough/account-verification/node/express"><strong>Account Verification</strong></a></p>
<p>Increase the security of your login system by verifying a user&#39;s mobile
phone.</p>
<p><a href="//www.twilio.com/docs/howto/walkthrough/server-notifications/node/express"><strong>Server
Notifications via SMS</strong></a></p>
<p>Faster than e-mail and less likely to get blocked, text messages are great for timely alerts and notifications. Learn how to send out SMS (and MMS) notifications to a list of server administrators.</p>
<h3 id="did-this-help-">Did this help?</h3>
<p>Thanks for checking out this tutorial! If you have any feedback to share 
with us, we&#39;d love to hear it. Tweet <a href="http://twitter.com/twilio">@twilio</a> 
to let us know what you think.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="models/User.js" data-mode="javascript">dmFyIG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTsKdmFyIGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdCcpOwp2YXIgY29uZmlnID0gcmVxdWlyZSgnLi4vY29uZmlnJyk7CgovLyBDcmVhdGUgYXV0aGVudGljYXRlZCBBdXRoeSBBUEkgY2xpZW50CnZhciBhdXRoeSA9IHJlcXVpcmUoJ2F1dGh5JykoY29uZmlnLmF1dGh5QXBpS2V5KTsKCi8vIFVzZWQgdG8gZ2VuZXJhdGUgcGFzc3dvcmQgaGFzaAp2YXIgU0FMVF9XT1JLX0ZBQ1RPUiA9IDEwOwoKLy8gRGVmaW5lIHVzZXIgbW9kZWwgc2NoZW1hCnZhciBVc2VyU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7CiAgICBmdWxsTmFtZTogewogICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgfSwKICAgIGNvdW50cnlDb2RlOiB7CiAgICAgICAgdHlwZTogU3RyaW5nLAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9LAogICAgcGhvbmU6IHsKICAgICAgICB0eXBlOiBTdHJpbmcsCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgIH0sCiAgICBhdXRoeUlkOiBTdHJpbmcsCiAgICBlbWFpbDogewogICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICB1bmlxdWU6IHRydWUKICAgIH0sCiAgICBwYXNzd29yZDogewogICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgfSwKICAgIGF1dGh5U3RhdHVzOiB7CiAgICAgICAgdHlwZTogU3RyaW5nLAogICAgICAgIGRlZmF1bHQ6ICd1bnZlcmlmaWVkJwogICAgfQp9KTsKCi8vIE1pZGRsZXdhcmUgZXhlY3V0ZWQgYmVmb3JlIHNhdmUgLSBoYXNoIHRoZSB1c2VyJ3MgcGFzc3dvcmQKVXNlclNjaGVtYS5wcmUoJ3NhdmUnLCBmdW5jdGlvbihuZXh0KSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgLy8gb25seSBoYXNoIHRoZSBwYXNzd29yZCBpZiBpdCBoYXMgYmVlbiBtb2RpZmllZCAob3IgaXMgbmV3KQogICAgaWYgKCFzZWxmLmlzTW9kaWZpZWQoJ3Bhc3N3b3JkJykpIHJldHVybiBuZXh0KCk7CgogICAgLy8gZ2VuZXJhdGUgYSBzYWx0CiAgICBiY3J5cHQuZ2VuU2FsdChTQUxUX1dPUktfRkFDVE9SLCBmdW5jdGlvbihlcnIsIHNhbHQpIHsKICAgICAgICBpZiAoZXJyKSByZXR1cm4gbmV4dChlcnIpOwoKICAgICAgICAvLyBoYXNoIHRoZSBwYXNzd29yZCB1c2luZyBvdXIgbmV3IHNhbHQKICAgICAgICBiY3J5cHQuaGFzaChzZWxmLnBhc3N3b3JkLCBzYWx0LCBmdW5jdGlvbihlcnIsIGhhc2gpIHsKICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIG5leHQoZXJyKTsKCiAgICAgICAgICAgIC8vIG92ZXJyaWRlIHRoZSBjbGVhcnRleHQgcGFzc3dvcmQgd2l0aCB0aGUgaGFzaGVkIG9uZQogICAgICAgICAgICBzZWxmLnBhc3N3b3JkID0gaGFzaDsKICAgICAgICAgICAgbmV4dCgpOwogICAgICAgIH0pOwogICAgfSk7CgogICAgaWYgKCFzZWxmLmF1dGh5SWQpIHsKICAgICAgICAvLyBSZWdpc3RlciB0aGlzIHVzZXIgaWYgaXQncyBhIG5ldyB1c2VyCiAgICAgICAgYXV0aHkucmVnaXN0ZXJfdXNlcihzZWxmLmVtYWlsLCBzZWxmLnBob25lLCBzZWxmLmNvdW50cnlDb2RlLCAKICAgICAgICAgICAgZnVuY3Rpb24oZXJyLCByZXNwb25zZSkgewogICAgICAgICAgICBpZihlcnIpewogICAgICAgICAgICAgICAgcmVzcG9uc2UuanNvbihlcnIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYuYXV0aHlJZCA9IHJlc3BvbnNlLnVzZXIuaWQ7CiAgICAgICAgICAgIHNlbGYuc2F2ZShmdW5jdGlvbihlcnIsIGRvYykgewogICAgICAgICAgICAgICAgaWYgKGVyciB8fCAhZG9jKSByZXR1cm4gbmV4dChlcnIpOwogICAgICAgICAgICAgICAgc2VsZiA9IGRvYzsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9Owp9KTsKCi8vIFRlc3QgY2FuZGlkYXRlIHBhc3N3b3JkClVzZXJTY2hlbWEubWV0aG9kcy5jb21wYXJlUGFzc3dvcmQgPSBmdW5jdGlvbihjYW5kaWRhdGVQYXNzd29yZCwgY2IpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGJjcnlwdC5jb21wYXJlKGNhbmRpZGF0ZVBhc3N3b3JkLCBzZWxmLnBhc3N3b3JkLCBmdW5jdGlvbihlcnIsIGlzTWF0Y2gpIHsKICAgICAgICBpZiAoZXJyKSByZXR1cm4gY2IoZXJyKTsKICAgICAgICBjYihudWxsLCBpc01hdGNoKTsKICAgIH0pOwp9OwoKLy8gU2VuZCBhIE9uZVRvdWNoIHJlcXVlc3QgdG8gdGhpcyB1c2VyClVzZXJTY2hlbWEubWV0aG9kcy5zZW5kT25lVG91Y2ggPSBmdW5jdGlvbihjYikgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgc2VsZi5hdXRoeVN0YXR1cyA9ICd1bnZlcmlmaWVkJzsKICAgIHNlbGYuc2F2ZSgpOwoKICAgIGF1dGh5LnNlbmRfYXBwcm92YWxfcmVxdWVzdCgKICAgICAgICBzZWxmLmF1dGh5SWQsCiAgICAgICAgZGV0YWlscyA9IHsKICAgICAgICAgICAgbWVzc2FnZTogIlJlcXVlc3QgdG8gTG9naW4gdG8gVHdpbGlvIGRlbW8gYXBwIiwKICAgICAgICAgICAgZW1haWw6IHNlbGYuZW1haWwsCiAgICAgICAgfSwKICAgICAgICBmdW5jdGlvbihlcnIsIGF1dGh5cmVzKXsKICAgICAgICAgICAgaWYgKGVyciAmJiBlcnIuc3VjY2VzcyAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGF1dGh5cmVzID0gZXJyOwogICAgICAgICAgICAgICAgZXJyID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYi5jYWxsKHNlbGYsIGVyciwgYXV0aHlyZXMpOwogICAgICAgIH0KICAgICk7Cn07CgovLyBTZW5kIGEgMkZBIHRva2VuIHRvIHRoaXMgdXNlcgpVc2VyU2NoZW1hLm1ldGhvZHMuc2VuZEF1dGh5VG9rZW4gPSBmdW5jdGlvbihjYikgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIGF1dGh5LnJlcXVlc3Rfc21zKHNlbGYuYXV0aHlJZCwgZnVuY3Rpb24oZXJyLCByZXNwb25zZSkgewogICAgICAgIGNiLmNhbGwoc2VsZiwgZXJyKTsKICAgIH0pOwp9OwoKLy8gVGVzdCBhIDJGQSB0b2tlbgpVc2VyU2NoZW1hLm1ldGhvZHMudmVyaWZ5QXV0aHlUb2tlbiA9IGZ1bmN0aW9uKG90cCwgY2IpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGF1dGh5LnZlcmlmeShzZWxmLmF1dGh5SWQsIG90cCwgZnVuY3Rpb24oZXJyLCByZXNwb25zZSkgewogICAgICAgIGNiLmNhbGwoc2VsZiwgZXJyLCByZXNwb25zZSk7CiAgICB9KTsKfTsKCi8vIEV4cG9ydCB1c2VyIG1vZGVsCm1vZHVsZS5leHBvcnRzID0gbW9uZ29vc2UubW9kZWwoJ1VzZXInLCBVc2VyU2NoZW1hKTsK</textarea>
<textarea class="saurus-file" data-file="config.js" data-mode="javascript">bW9kdWxlLmV4cG9ydHMgPSB7CiAgICAvLyBIVFRQIHBvcnQKICAgIHBvcnQ6IHByb2Nlc3MuZW52LlBPUlQgfHwgMzAwMCwKICAgIAogICAgLy8gUHJvZHVjdGlvbiBBdXRoeSBBUEkga2V5CiAgICBhdXRoeUFwaUtleTogcHJvY2Vzcy5lbnYuQVVUSFlfQVBJX0tFWSwKCiAgICAvLyBNb25nb0RCIGNvbm5lY3Rpb24gc3RyaW5nIC0gTU9OR09fVVJMIGlzIGZvciBsb2NhbCBkZXYsCiAgICAvLyBNT05HT0xBQl9VUkkgaXMgZm9yIHRoZSBNb25nb0xhYiBhZGQtb24gZm9yIEhlcm9rdSBkZXBsb3ltZW50CiAgICBtb25nb1VybDogcHJvY2Vzcy5lbnYuTU9OR09MQUJfVVJJIHx8IHByb2Nlc3MuZW52Lk1PTkdPX1VSTAp9Ow==</textarea>
<textarea class="saurus-file" data-file="api/sessions.js" data-mode="javascript">dmFyIFNlc3Npb24gPSByZXF1aXJlKCcuLi9tb2RlbHMvU2Vzc2lvbicpOwp2YXIgVXNlciA9IHJlcXVpcmUoJy4uL21vZGVscy9Vc2VyJyk7CnZhciBlcnJvciA9IHJlcXVpcmUoJy4vcmVzcG9uc2VfdXRpbHMnKS5lcnJvcjsKdmFyIG9rID0gcmVxdWlyZSgnLi9yZXNwb25zZV91dGlscycpLm9rOwoKLy8gQ3JlYXRlIGEgbmV3IHNlc3Npb24sIGZpcnN0IHRlc3RpbmcgdXNlcm5hbWUvcGFzc3dvcmQgY29tYm8KZXhwb3J0cy5jcmVhdGUgPSBmdW5jdGlvbihyZXF1ZXN0LCByZXNwb25zZSkgewogICAgdmFyIGVtYWlsID0gcmVxdWVzdC5ib2R5LmVtYWlsOwogICAgdmFyIGNhbmRpZGF0ZVBhc3N3b3JkID0gcmVxdWVzdC5ib2R5LnBhc3N3b3JkOwoKICAgIC8vIExvb2sgZm9yIGEgdXNlciBieSB0aGUgZ2l2ZW4gdXNlcm5hbWUKICAgIFVzZXIuZmluZE9uZSh7CiAgICAgICAgZW1haWw6IGVtYWlsCiAgICB9LCBmdW5jdGlvbihlcnIsIHVzZXIpIHsKICAgICAgICBpZiAoZXJyIHx8ICF1c2VyKSByZXR1cm4gaW52YWxpZCgpOwoKICAgICAgICAvLyBXZSBoYXZlIGEgdXNlciBmb3IgdGhhdCB1c2VybmFtZSwgdGVzdCBwYXNzd29yZAogICAgICAgIHVzZXIuY29tcGFyZVBhc3N3b3JkKGNhbmRpZGF0ZVBhc3N3b3JkLCBmdW5jdGlvbihlcnIsIG1hdGNoKSB7CiAgICAgICAgICAgIGlmIChlcnIgfHwgIW1hdGNoKSByZXR1cm4gaW52YWxpZCgpOwogICAgICAgICAgICByZXR1cm4gdmFsaWQodXNlcik7CiAgICAgICAgfSk7CiAgICB9KTsKCiAgICAvLyByZXNwb25kIHdpdGggYSA0MDMgZm9yIGEgbG9naW4gZXJyb3IKICAgIGZ1bmN0aW9uIGludmFsaWQoKSB7CiAgICAgICAgZXJyb3IocmVzcG9uc2UsIDQwMywgJ0ludmFsaWQgdXNlcm5hbWUvcGFzc3dvcmQgY29tYmluYXRpb24uJyk7CiAgICB9CgogICAgLy8gcmVzcG9uZCB3aXRoIGEgbmV3IHNlc3Npb24gZm9yIGEgdmFsaWQgcGFzc3dvcmQsIGFuZCBzZW5kIGEgT25lVG91Y2ggcmVxdWVzdAogICAgZnVuY3Rpb24gdmFsaWQodXNlcikgewogICAgICAgIFNlc3Npb24uY3JlYXRlU2Vzc2lvbkZvclVzZXIodXNlciwgZmFsc2UsIGZ1bmN0aW9uKGVyciwgc2VzcywgYXV0aHlSZXNwb25zZSkgewogICAgICAgICAgICBpZiAoZXJyIHx8ICFzZXNzKSB7CiAgICAgICAgICAgICAgICBlcnJvcihyZXNwb25zZSwgNTAwLCAKICAgICAgICAgICAgICAgICAgICAnRXJyb3IgY3JlYXRpbmcgc2Vzc2lvbiAtIHBsZWFzZSBsb2cgaW4gYWdhaW4uJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBTZW5kIHRoZSB1bmlxdWUgdG9rZW4gZm9yIHRoaXMgc2Vzc2lvbiBhbmQgdGhlIG9uZXRvdWNoIHJlc3BvbnNlCiAgICAgICAgICAgICAgICByZXNwb25zZS5zZW5kKHsKICAgICAgICAgICAgICAgICAgICB0b2tlbjogc2Vzcy50b2tlbiwKICAgICAgICAgICAgICAgICAgICBhdXRoeVJlc3BvbnNlOiBhdXRoeVJlc3BvbnNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQp9OwoKLy8gRGVzdHJveSB0aGUgZ2l2ZW4gc2Vzc2lvbiAobG9nIG91dCkKZXhwb3J0cy5kZXN0cm95ID0gZnVuY3Rpb24ocmVxdWVzdCwgcmVzcG9uc2UpIHsKICAgIHJlcXVlc3Quc2Vzc2lvbiAmJiByZXF1ZXN0LnNlc3Npb24ucmVtb3ZlKGZ1bmN0aW9uKGVyciwgZG9jKSB7CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICBlcnJvcihyZXNwb25zZSwgNTAwLCAnVGhlcmUgd2FzIGEgcHJvYmxlbSBsb2dnaW5nIHlvdSBvdXQgLSBwbGVhc2UgcmV0cnkuJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb2socmVzcG9uc2UpOwogICAgICAgIH0KICAgIH0pOwp9OwoKLy8gVmFsaWRhdGUgYSAyRkEgdG9rZW4gCmV4cG9ydHMuYXV0aHlDYWxsYmFjayA9IGZ1bmN0aW9uKHJlcXVlc3QsIHJlc3BvbnNlKSB7CiAgICB2YXIgYXV0aHlJZCA9IHJlcXVlc3QuYm9keS5hdXRoeV9pZDsKCiAgICAvLyBMb29rIGZvciBhIHVzZXIgd2l0aCB0aGUgYXV0aHlfaWQgc3VwcGxpZXMKICAgIFVzZXIuZmluZE9uZSh7CiAgICAgICAgYXV0aHlJZDogYXV0aHlJZAogICAgfSwgZnVuY3Rpb24oZXJyLCB1c2VyKSB7CiAgICAgICAgaWYgKGVyciB8fCAhdXNlcikgcmV0dXJuIGludmFsaWQoKTsKICAgICAgICB1c2VyLmF1dGh5U3RhdHVzID0gcmVxdWVzdC5ib2R5LnN0YXR1czsKICAgICAgICB1c2VyLnNhdmUoKTsKICAgIH0pOwogICAgcmVzcG9uc2UuZW5kKCk7Cn07CgovLyBWYWxpZGF0ZSBhIDJGQSB0b2tlbiAKZXhwb3J0cy5hdXRoeVN0YXR1cyA9IGZ1bmN0aW9uKHJlcXVlc3QsIHJlc3BvbnNlKSB7CiAgICB2YXIgc3RhdHVzID0gcmVxdWVzdC51c2VyLmF1dGh5U3RhdHVzOwogICAgaWYgKHN0YXR1cyA9PSAnYXBwcm92ZWQnKSB7CiAgICAgICAgcmVxdWVzdC5zZXNzaW9uLmNvbmZpcm1lZCA9IHRydWU7CiAgICAgICAgcmVxdWVzdC5zZXNzaW9uLnNhdmUoZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgICAgIGlmIChlcnIpIHJldHVybiBlcnJvcihyZXNwb25zZSwgNTAwLCAKICAgICAgICAgICAgICAgICdUaGVyZSB3YXMgYW4gZXJyb3IgdmFsaWRhdGluZyB5b3VyIHNlc3Npb24uJyk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoIXJlcXVlc3Quc2Vzc2lvbikgewogICAgICAgIHJldHVybiBlcnJvcihyZXNwb25zZSwgNDA0LCAnTm8gdmFsaWQgc2Vzc2lvbiBmb3VuZCBmb3IgdGhpcyB1c2VyLicpOwogICAgfSBlbHNlIHsKICAgICAgICByZXNwb25zZS5zZW5kKHsgc3RhdHVzOiBzdGF0dXMgfSk7CiAgICB9ICAgCn07CgovLyBWYWxpZGF0ZSBhIDJGQSB0b2tlbiAKZXhwb3J0cy52ZXJpZnkgPSBmdW5jdGlvbihyZXF1ZXN0LCByZXNwb25zZSkgewogICAgdmFyIG9uZVRpbWVDb2RlID0gcmVxdWVzdC5ib2R5LmNvZGU7CgogICAgaWYgKCFyZXF1ZXN0LnNlc3Npb24gfHwgIXJlcXVlc3QudXNlcikgewogICAgICAgIHJldHVybiBlcnJvcihyZXNwb25zZSwgNDA0LCAnTm8gdmFsaWQgc2Vzc2lvbiBmb3VuZCBmb3IgdGhpcyB0b2tlbi4nKTsKICAgIH0KCiAgICAvLyB2ZXJpZnkgZW50ZXJlZCBhdXRoeSBjb2RlCiAgICByZXF1ZXN0LnVzZXIudmVyaWZ5QXV0aHlUb2tlbihvbmVUaW1lQ29kZSwgZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgaWYgKGVycikgcmV0dXJuIGVycm9yKHJlc3BvbnNlLCA0MDEsICdJbnZhbGlkIGNvbmZpcm1hdGlvbiBjb2RlLicpOwoKICAgICAgICAvLyBvdGhlcndpc2Ugd2UncmUgZ29vZCEgVmFsaWRhdGUgdGhlIHNlc3Npb24KICAgICAgICByZXF1ZXN0LnNlc3Npb24uY29uZmlybWVkID0gdHJ1ZTsKICAgICAgICByZXF1ZXN0LnNlc3Npb24uc2F2ZShmdW5jdGlvbihlcnIpIHsKICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIGVycm9yKHJlc3BvbnNlLCA1MDAsIAogICAgICAgICAgICAgICAgJ1RoZXJlIHdhcyBhbiBlcnJvciB2YWxpZGF0aW5nIHlvdXIgc2Vzc2lvbi4nKTsKCiAgICAgICAgICAgIHJlc3BvbnNlLnNlbmQoewogICAgICAgICAgICAgICAgdG9rZW46IHJlcXVlc3Quc2Vzc2lvbi50b2tlbgogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0pOwp9OwoKLy8gUmVzZW5kIHZhbGlkYXRpb24gY29kZQpleHBvcnRzLnJlc2VuZCA9IGZ1bmN0aW9uKHJlcXVlc3QsIHJlc3BvbnNlKSB7CiAgICBpZiAoIXJlcXVlc3QudXNlcikgcmV0dXJuIGVycm9yKHJlc3BvbnNlLCA0MDQsIAogICAgICAgICdObyB1c2VyIGZvdW5kIGZvciB0aGlzIHNlc3Npb24sIHBsZWFzZSBsb2cgaW4gYWdhaW4uJyk7CgogICAgLy8gT3RoZXJ3aXNlIHJlc2VuZCB0aGUgY29kZQogICAgcmVxdWVzdC51c2VyLnNlbmRBdXRoeVRva2VuKGZ1bmN0aW9uKGVycikgewogICAgICAgIGlmICghcmVxdWVzdC51c2VyKSByZXR1cm4gZXJyb3IocmVzcG9uc2UsIDUwMCwgCiAgICAgICAgICAgICdObyB1c2VyIGZvdW5kIGZvciB0aGlzIHNlc3Npb24sIHBsZWFzZSBsb2cgaW4gYWdhaW4uJyk7CgogICAgICAgIG9rKHJlc3BvbnNlKTsKICAgIH0pOwp9Ow==</textarea>
<textarea class="saurus-file" data-file="public/app/views/Login.js" data-mode="javascript">KGZ1bmN0aW9uKCkgewogICAgYXBwLnZpZXdzLkxvZ2luVmlldyA9IGFwcC52aWV3cy5CYXNlVmlldy5leHRlbmQoewogICAgICAgIC8vIG5hbWUgb2YgdGhlIHRlbXBsYXRlIGZpbGUgdG8gbG9hZCBmcm9tIHRoZSBzZXJ2ZXIKICAgICAgICB0ZW1wbGF0ZU5hbWU6ICdsb2dpbicsCgogICAgICAgIC8vIFVJIGV2ZW50cwogICAgICAgIGV2ZW50czogewogICAgICAgICAgICAnc3VibWl0ICNsb2dpbkZvcm0nOiAnbG9naW4nCiAgICAgICAgfSwKCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgLy8gZGVmYXVsdCBiZWhhdmlvciwgcmVuZGVyIHBhZ2UgaW50byAjcGFnZSBzZWN0aW9uCiAgICAgICAgICAgIGFwcC5yb3V0ZXIub24oJ3JvdXRlOmxvZ2luJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcigpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAoKICAgICAgICAvLyBIaXQgbG9naW4gc2VydmljZQogICAgICAgIGxvZ2luOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgYXBwLnNldCgnbWVzc2FnZScsIG51bGwpOwogICAgICAgICAgICAkLmFqYXgoJy9zZXNzaW9uJywgewogICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHNlbGYuJCgnI2VtYWlsJykudmFsKCksCiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHNlbGYuJCgnI3Bhc3N3b3JkJykudmFsKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICAvLyBJZiBzZXNzaW9uIHJldHVybnMgb25lVG91Y2ggc3RhdHVzLnN1Y2Nlc3Mgd2FpdCBmb3Igb25lU3RhdHVzIGFwcHJvdmFsCiAgICAgICAgICAgICAgICBhcHAuc2V0KCd0b2tlbicsIGRhdGEudG9rZW4pOwogICAgICAgICAgICAgICAgaWYgKGRhdGEuYXV0aHlSZXNwb25zZS5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgYXBwLnNldCgnb25ldG91Y2gnLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBhcHAuc2V0KCdtZXNzYWdlJywgewogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdBd2FpdGluZyBPbmUgVG91Y2ggYXBwcm92YWwuJwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHNlbGYuY2hlY2tPbmVUb3VjaFN0YXR1cygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhcHAucm91dGVyLm5hdmlnYXRlKCd2ZXJpZnknLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXI6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHsKICAgICAgICAgICAgICAgIGFwcC5zZXQoJ21lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyLnJlc3BvbnNlSlNPTi5tZXNzYWdlIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICdTb3JyeSwgYW4gZXJyb3Igb2NjdXJyZWQsIHBsZWFzZSBsb2cgaW4gYWdhaW4uJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCgogICAgICAgIGNoZWNrT25lVG91Y2hTdGF0dXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICQuYWpheCgnL2F1dGh5L3N0YXR1cycsIHsKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgJ1gtQVBJLVRPS0VOJzogYXBwLmdldCgndG9rZW4nKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PSAnYXBwcm92ZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgYXBwLnJvdXRlci5uYXZpZ2F0ZSgndXNlcicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnN0YXR1cyA9PSAnZGVuaWVkJykgewogICAgICAgICAgICAgICAgICAgIGFwcC5yb3V0ZXIubmF2aWdhdGUoJ3ZlcmlmeScsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGFwcC5zZXQoJ21lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnT25lVG91Y2ggTG9naW4gcmVxdWVzdCBkZW5pZWQuJwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHNlbGYuY2hlY2tPbmVUb3VjaFN0YXR1cygpLCAzMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7Cn0pKCk7</textarea>
<textarea class="saurus-file" data-file="models/Session.js" data-mode="javascript">dmFyIG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTsKdmFyIHV1aWQgPSByZXF1aXJlKCdub2RlLXV1aWQnKTsKdmFyIFVzZXIgPSByZXF1aXJlKCcuL1VzZXInKTsKCi8vIERlZmluZSBzZXNzaW9uIG1vZGVsIHNjaGVtYQp2YXIgU2Vzc2lvblNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoewogICAgdXNlcklkOiB7CiAgICAgICAgdHlwZTogU3RyaW5nLAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9LAogICAgdG9rZW46IHsKICAgICAgICB0eXBlOiBTdHJpbmcsCiAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgdW5pcXVlOiB0cnVlCiAgICB9LAogICAgY29uZmlybWVkOiB7CiAgICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgICBkZWZhdWx0OiBmYWxzZQogICAgfQp9KTsKCi8vIENyZWF0ZSBhIHNlc3Npb24gZm9yIHRoZSBnaXZlbiB1c2VyClNlc3Npb25TY2hlbWEuc3RhdGljcy5jcmVhdGVTZXNzaW9uRm9yVXNlciA9IGZ1bmN0aW9uKHVzZXIsIGNvbmYsIGNiKSB7CiAgICB2YXIgbmV3U2Vzc2lvbiA9IG5ldyBTZXNzaW9uKHsKICAgICAgICB1c2VySWQ6IHVzZXIuX2lkLAogICAgICAgIGNvbmZpcm1lZDogY29uZiwKICAgICAgICB0b2tlbjogdXVpZC52MSgpCiAgICB9KTsKICAgIC8vIHdlIG5lZWQgdG8gZG8gdGhlIDJGQSBzdGVwIGZpcnN0CiAgICBpZiAoIWNvbmYpIHsKICAgICAgICB1c2VyLnNlbmRPbmVUb3VjaChmdW5jdGlvbihlcnIsIGF1dGh5UmVzcG9uc2UpIHsKICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIGNiLmNhbGwobmV3U2Vzc2lvbiwgZXJyKTsKICAgICAgICAgICAgc2F2ZShhdXRoeVJlc3BvbnNlKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8gaWYgaXQncyBwcmUtY29uZmlybWVkIGp1c3Qgc2F2ZSB0aGUgc2Vzc2lvbgogICAgICAgIHNhdmUoKTsKICAgIH0KCiAgICAvLyBTYXZlIHRoZSBzZXNzaW9uIG9iamVjdAogICAgZnVuY3Rpb24gc2F2ZShhdXRoeVJlc3BvbnNlKSB7CiAgICAgICAgbmV3U2Vzc2lvbi5zYXZlKGZ1bmN0aW9uKGVyciwgZG9jKSB7CiAgICAgICAgICAgIGNiLmNhbGwobmV3U2Vzc2lvbiwgZXJyLCBkb2MsIGF1dGh5UmVzcG9uc2UpOwogICAgICAgIH0pOwogICAgfQp9OwoKLy8gR2V0IGEgdXNlciBtb2RlbCBmb3IgdGhpcyBzZXNzaW9uClNlc3Npb25TY2hlbWEubWV0aG9kcy5nZXRVc2VyID0gZnVuY3Rpb24oY2IpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIFVzZXIuZmluZEJ5SWQoc2VsZi51c2VySWQsIGNiKTsKfTsKCi8vIEV4cG9ydCB1c2VyIG1vZGVsCnZhciBTZXNzaW9uID0gbW9uZ29vc2UubW9kZWwoJ1Nlc3Npb24nLCBTZXNzaW9uU2NoZW1hKTsKbW9kdWxlLmV4cG9ydHMgPSBTZXNzaW9uOwo=</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/authy2fa-node" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>